<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome file</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="dqn--ga--tkinter-for-job-shop-scheduling-problem">DQN / GA / tkinter for job-shop scheduling problem</h1>
<p>此專題以Deep Q Network及Genetic Algorithm實作零工式生產排程問題，並以tkinter設計使用者介面方便進行互動。</p>
<p>Deep Q Network : 架構來自<a href="https://github.com/jack781114/DQN-for-job-shop-scheduling">DQN-for-job-shop-scheduling</a>，我修改一些參數及視覺化方法。<br>
Genetic Algorithm : 架構來自<a href="https://github.com/wurmen/Genetic-Algorithm-for-Job-Shop-Scheduling-and-NSGA-II/blob/master/implementation%20with%20python/GA-jobshop/GA_For_Jobshop.md">Genetic-Algorithm-for-Job-Shop-Scheduling</a>，我修改了參數並整理程式碼。<br>
tkinter : 範本來自<a href="https://github.com/TomSchimansky/CustomTkinter">CustomTkinter</a>。</p>
<h2 id="dqn筆記">DQN筆記</h2>
<ul>
<li>
<p><strong>DQN流程</strong> : 將數據集輸入到<code>JSP_env</code>⭢ <code>Agent / RL_network</code>處理和分析數據 ⭢ <code>action_space</code>選擇行動 ⭢ 當記憶體儲存超過 <em>batch_size</em> 開始進行抽樣學習 ⭢ 當所有工單分配完畢即完成1個<em>epoch</em> ⭢ 完成所有 <em>epoch</em> 後輸出最好的排程結果。<br>
<br><img src="https://github.com/woodwood0/DQN-GA-tkinter-for-job-shop-scheduling-problem/assets/171545924/78be0748-4c21-4d73-a0f2-1e01ef3ce810" alt="293317671-7900ee85-b7e6-4cf2-bda3-3233beee762b"><br>
<br></p>
</li>
<li>
<p><strong>Dueling DQN</strong> : 將一個神經網絡的架構分成兩個獨立的路徑：一個計算狀態值 𝑉(𝑠)，另一個計算各個動作的優勢 𝐴(𝑠,𝑎)，最終輸出 𝑄(𝑠,𝑎) 是這兩個部分的組合，此結構更有效地學習狀態值與個別動作的重要性。<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo>=</mo><mi>V</mi><mo stretchy="false">(</mo><mi>s</mi><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mtext>−</mtext><mfrac><mn>1</mn><mrow><mo>∣</mo><mi>A</mi><mo>∣</mo></mrow></mfrac><munder><mo>∑</mo><mstyle scriptlevel="1"><mtable rowspacing="0.1000em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr></mtable></mstyle></munder><mtext>​</mtext><mi>A</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><msup><mi>a</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">
Q(s,a)=V(s)+(A(s,a)−\frac{1}{∣A∣} \sum_{  \begin{subarray}{l}a'\end{subarray}}​A(s,a'))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.22222em;">V</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.84293em; vertical-align: -1.52148em;"></span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mrel">∣</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∣</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.80625em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.753914em;"><span class="" style="top: -2.75391em;"><span class="pstrut" style="height: 2.82783em;"></span><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.253914em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.52148em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">​</span><span class="mord mathnormal">A</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.801892em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">))</span></span></span></span></span></span>其公式表達 𝑄(𝑠,𝑎) 為在當前狀態 𝑠，𝑉(𝑠) 和相對具有優勢的執行動作 𝑎 所加總的價值。<br>
𝑉(𝑠) 代表在給定狀態 𝑠 下的總體價值，而 𝐴(𝑠,𝑎) 表示執行動作 𝑎 相對於其他可選動作的優勢，為了防止 𝑄(𝑠,𝑎) 脫離實際值，從每個優勢值中扣除所有可能動作的優勢值平均。當所有動作的優勢均為零時，即各個動作相對於彼此沒有額外的價值或優勢，此時𝑄(𝑠,𝑎) 完全由狀態值 𝑉(𝑠) 決定，𝑄(𝑠,𝑎) 的評估是以整體狀態為基準，而非單一動作，因此整體的價值估計不會被動作的選擇所偏移。</p>
</li>
<li>
<p><strong>Double DQN</strong> : 旨在解決原始DQN中的過度估計問題（因為在選擇和評估最佳動作時同時使用同一網絡），透過使用<strong>目標網絡</strong>和<strong>評估網絡</strong>分離最大𝑄值的選擇與評估。每次更新時，評估網絡負責選擇最佳動作，目標網絡負責評估該動作的𝑄值，這樣能減少值的估計偏差。</p>
<ol>
<li>
<p>首先，使用評估網絡來選擇在當前狀態 𝑠 下估計最佳的動作 𝑎：<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>a</mi><mo>∗</mo></msup><mo>=</mo><munder><mrow><mi mathvariant="normal">arg max</mi><mo>⁡</mo></mrow><mstyle scriptlevel="1"><mtable rowspacing="0.1000em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="1" displaystyle="false"><mi>a</mi></mstyle></mtd></mtr></mtable></mstyle></munder><mtext>​</mtext><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><mi>a</mi><mo separator="true">;</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">
{a^*}=\argmax_{  \begin{subarray}{l}a\end{subarray}}​Q(s,a;θ)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.738696em; vertical-align: 0em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.738696em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.68314em; vertical-align: -0.933136em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.43056em;"><span class="" style="top: -2.20556em; margin-left: 0em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.55528em;"><span class="" style="top: -2.82472em;"><span class="pstrut" style="height: 2.7em;"></span><span class="mord mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.05528em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class=""><span class="mop"><span class="mord mathrm" style="margin-right: 0.01389em;">arg</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathrm">max</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.933136em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">​</span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal">a</span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathnormal" style="margin-right: 0.02778em;">θ</span><span class="mclose">)</span></span></span></span></span></span> 其中 𝜃 是評估網絡的參數。</p>
</li>
<li>
<p>然後，使用目標網絡來評估這個動作的𝑄值：<br>
<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>Q</mi><mo stretchy="false">(</mo><mi>s</mi><mo separator="true">,</mo><msup><mi>a</mi><mo>∗</mo></msup><mo separator="true">;</mo><msup><mi>θ</mi><mtext>−</mtext></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">
Q(s,{a^*};{θ^−})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.07133em; vertical-align: -0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.738696em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span></span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.02778em;">θ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.821331em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">−</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></span>其中 𝜃− 是目標網絡的參數。</p>
</li>
</ol>
<p>其公式表達在當前狀態 𝑠，先以評估網絡選擇最具優勢的動作 𝑎 ，再用目標網路評估該動作的𝑄值。其中目標網絡的參數 𝜃− 會定期從評估網絡的參數 𝜃 複製更新（頻率在程式碼中自行設定）。這種更新策略確保了目標網絡在一定時間內保持固定，讓評估網絡能在一個相對穩定的環境下學習，減少因快速變動的目標而導致的學習不穩定和估計偏差。</p>
</li>
<li>
<p><strong>Memory / PreMemory</strong> :<br>
<code>Memory類別</code>使用<code>deque</code>數據結構來管理經驗，它自動從頭部移除最舊的數據以維持設定的容量，通過<code>remember</code>方法加入新經驗，<code>sample</code>方法隨機選取一批經驗用於訓練。<br>
<code>PreMemory類別</code>使用<code>SumTree</code>結構來存儲經驗並根據優先級來管理，使用<code>get_priority</code>方法計算基於誤差的優先級，誤差越大，優先級越高，按優先級加權抽樣，並在後續根據新的誤差更新優先級。</p>
</li>
</ul>
<h2 id="ga筆記">GA筆記</h2>
<ul>
<li>
<p><strong>GA流程</strong> :<br>
<code>generate_initial_population</code>生成初始種群，每條染色體代表一種潛在的調度方案 ⭢<br>
進行<code>two_point_crossover</code>雙點交叉和<code>mutate_chromosome</code>循環突變 ⭢<br>
<code>repair_chromosome</code>調整重複或缺失的基因，確保每條染色體都是可行解 ⭢<br>
<code>calculate_fitness</code>計算每條染色體的適應度，適應度為完工時間的倒數（1/makespan）⭢<br>
<code>roulette_wheel_selection</code>輪盤式選擇適應度高的染色體 ⭢<br>
<code>run</code>達到指定的迭代次數 ⭢ <code>plot_gantt_chart</code>繪製甘特圖。<br>
<img src="https://github.com/woodwood0/DQN-GA-tkinter-for-job-shop-scheduling-problem/assets/171545924/56e01f77-feac-47d3-a2f4-818c65853690" alt="圖片1"></p>
</li>
<li>
<p><strong>交叉和突變</strong> :<br>
<img src="https://github.com/woodwood0/DQN-GA-tkinter-for-job-shop-scheduling-problem/assets/171545924/0eb80004-c3dd-4af4-b52f-43fdee979d11" alt="img1"><br>
雙點交叉：隨機選取兩個交換點，將兩點之間的基因互換，進而產生新的染色體序列。<br>
<img src="https://github.com/woodwood0/DQN-GA-tkinter-for-job-shop-scheduling-problem/assets/171545924/217d3d32-3e33-4a4d-8087-eb8209263310" alt="img2"><br>
循環突變：隨機選取兩個交換點，將兩點之間的基因以循環方式移動，第一點的基因移動到下一點的位置，直到原來最後一點的基因移動到第一點。</p>
</li>
</ul>
<h2 id="tkinter">tkinter</h2>
<ul>
<li>
<p><strong>tkinter流程</strong> : 選擇DQN或GA模型 ⭢ 更改或使用預設的模型參數數值 ⭢ 輸入數據集的檔名 ⭢ 進行排程。<br>
在此專案的使用者介面中，DQN為Double DQN，亦可視需求加入Dueling DQN。</p>
<p><img src="https://github.com/woodwood0/DQN-GA-tkinter-for-job-shop-scheduling-problem/assets/171545924/e28a0ce6-87b3-4d89-81e8-915fe7b0fdd0" alt="圖片4"></p>
</li>
</ul>
<h2 id="output">Output</h2>
<ul>
<li>
<p><strong>繪製甘特圖</strong> :</p>
<p><img src="https://github.com/woodwood0/DQN-GA-tkinter-for-job-shop-scheduling-problem/assets/171545924/7bad38b3-402f-4a55-85a8-1e837960e1a4" alt="圖片5"></p>
</li>
</ul>
</div>
</body>

</html>
